<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../styles/reset.css" rel="stylesheet" type="text/css">
  <link href="../styles/species_browser.css " rel="stylesheet" type="text/css">
  <link href="../styles/header_footer.css" rel="stylesheet" type="text/css">
  <script src="./components/header.js" type="text/javascript" defer></script>
  <script src="./components/footer.js" type="text/javascript" defer></script>
  <title>Leish-ESP</title>
</head>

<body>
    <!-- ================================================================================================ -->
  <!-- Header -->
  <!-- ================================================================================================ -->
  <header-component></header-component>
  <!-- ================================================================================================ -->
  <!-- Main section -->
  <!-- ================================================================================================ -->
  <main>
    <section id="desc-genome-selector">
      <a href="infantum.html" id="selector-1"><span id="lang_species_desc">Description</span></a>
      <a href="#" id="selector-2"><span id="lang_species_brow">Browser</span></a>
    </section>

    <section id="browser-section">
      <div id="search bar">
        <label for="search-input"></label><input type="text" id="search-input" placeholder="Search for genes, names, or orthologs...">
        <button id="search-button">Search</button>
      </div>

      <div class="pagination-controls">
        <button class="prev-page">Previous</button>
        <button class="next-page">Next</button>
      </div>

      <!-- Top Scrollbar -->
      <div id="top-scroll-container">
        <div id="top-scroll"></div>
      </div>

      <div id="results-container">
          <table id="results-table">
              <thead>
                  <tr>
                      <th>Gene ID</th>
                      <th>Name</th>
                      <th>Other Names</th>
                      <th>Wikidata</th>
                      <th>Mendeley</th>
                      <th>UniProt</th>
                      <th>LmjF Ortholog</th>
                      <th>LmjFC Ortholog</th>
                      <th>LdHU3 Ortholog</th>
                      <th>LBRM2904 Ortholog</th>
                  </tr>
              </thead>
              <tbody id="results-body">
                  <!-- Results will be populated here -->
              </tbody>
          </table>
      </div>

      <div class="pagination-controls">
        <button class="prev-page">Previous</button>
        <button class="next-page">Next</button>
      </div>
    </section>

  </main>
  <!-- ================================================================================================ -->
  <!-- Footer -->
  <!-- ================================================================================================ -->
  <footer-component></footer-component>
  <!-- ================================================================================================ -->
  <!-- JavaScript -->
  <!-- ================================================================================================ -->
  <script src="../scripts/pages/translate_infantum.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const topScrollContainer = document.getElementById('top-scroll-container');
        const resultsContainer = document.getElementById('results-container');
        const topScroll = document.getElementById('top-scroll');

        // Set the width of the top-scroll to match the content of the results table
        function updateScrollWidths() {
          topScroll.style.width = `${resultsContainer.scrollWidth}px`;
        }

        // Ensure the width is set initially and after each data fetch
        updateScrollWidths();
        resultsContainer.addEventListener('scroll', function () {
          topScrollContainer.scrollLeft = resultsContainer.scrollLeft;
        });

        topScrollContainer.addEventListener('scroll', function () {
          resultsContainer.scrollLeft = topScrollContainer.scrollLeft;
        });

        // Recalculate the width if the window is resized
        window.addEventListener('resize', updateScrollWidths);

        // Fetch and populate data (for demonstration)
        function fetchData(page) {
          const query = document.getElementById('search-input').value;
          fetch(`/search?q=${encodeURIComponent(query)}&page=${page}&limit=${limit}`)
                  .then(response => response.json())
                  .then(data => {
                    populateTable(data);
                    updateScrollWidths(); // Update scroll width after table is populated
                  });
        }

        function populateTable(data) {
          const resultsBody = document.getElementById('results-body');
          resultsBody.innerHTML = '';

          data.forEach(row => {
            const tr = document.createElement('tr');

            Object.keys(row).forEach(key => {
              const td = document.createElement('td');

              if (key === "Wikidata" || key === "Mendeley" || key === "UniProt") {
                td.innerHTML = `<a href="${row[key]}" target="_blank">${key}</a>`;
              } else {
                td.textContent = row[key];
              }

              tr.appendChild(td);
            });

            resultsBody.appendChild(tr);
          });
        }

        // Initialize the first data load
        let currentPage = 1;
        const limit = 50;
        fetchData(currentPage);

        document.getElementById('search-button').addEventListener('click', function () {
          currentPage = 1;
          fetchData(currentPage);
        });

        // Attach event listeners to both sets of pagination buttons
        const paginationButtons = document.querySelectorAll('.pagination-controls button');

        paginationButtons.forEach(button => {
          button.addEventListener('click', function (event) {
            if (event.target.classList.contains('next-page')) {
              currentPage++;
              fetchData(currentPage);
            } else if (event.target.classList.contains('prev-page')) {
              if (currentPage > 1) {
                currentPage--;
                fetchData(currentPage);
              }
            }
          });
        });
      });
    </script>
</body>
</html>